# MediTrack System Specification

- Version: 1.0
- Status: Proposed
- Last Updated: 14/12/2025
- Maintainers: Sudhanshu

## 1. Purpose
This document defines all fixed contracts for the MediTrack Clinic & Appointment Management System.
Nothing in here is allowed to change without consensus of whole team.

---

# 2. High-Level Architecture

```
Main (CLI) 
 ↓
Services (DoctorService, PatientService, AppointmentService)
 ↓
DataStore<T>  (CRUD persistence)
 ↓
Serialized data files (.dat)
```

**Entities** represent the domain.  
**Services** hold all business logic.  
**Validators/Utils** provide pure functions with no side effects.  
**DataStore** owns all persistence.

---

# 3. Entities (Fields + Rules)

## 3.1 Person  
```java
id: String (generated by IdGenerator)
name: String
age: int
gender: String (M/F/Other)
```

## 3.2 Doctor extends Person  
```java
specialization: String
availableSlots: List<LocalDateTime>
```

## 3.3 Patient extends Person
```java
medicalHistory: List<String>
```

## 3.4 Appointment  
```java
id: String
doctorId: String
patientId: String
appointmentTime: LocalDateTime
status: String ("SCHEDULED", "COMPLETED", "CANCELLED")
```

**Rules**
- No overlapping appointments for the same doctor at the same time.  
- Appointment time must be future or present.

## 3.5 Bill  
```java
id: String
paid: boolean
amount: double
appointmentId: String
```

## 3.6 BillSummary (immutable)  
```java
amount: double
doctorName: String
date: LocalDateTime
patientName: String
appointmentId: String
```
- All fields final.  
- No setters.  
- Defensive copies for dates.

---

# 4. Interfaces

## 4.1 Searchable<T>  
```java
T searchById(String id);
List<T> searchByName(String name);
```

## 4.2 Payable  
```java
double calculateBill();
```

---

# 5. Services — Method Contracts

## 5.1 DoctorService  
```java
List<Doctor> getAllDoctors();
Doctor getDoctor(String id);
void deleteDoctor(String id);
Doctor addDoctor(Doctor doctor);
void updateDoctor(Doctor doctor);
List<Doctor> searchByName(String name);
```

## 5.2 PatientService  
Same contract shape as DoctorService.

## 5.3 AppointmentService  
```java
Appointment bookAppointment(String doctorId, String patientId, LocalDateTime time)
    throws InvalidDataException;

Appointment getAppointment(String id)
    throws AppointmentNotFoundException;

List<Appointment> getAppointmentsForDoctor(String doctorId);
List<Appointment> getAppointmentsForPatient(String patientId);

void cancelAppointment(String id)
    throws AppointmentNotFoundException;

Bill generateBill(String appointmentId);
```

---

# 6. DataStore<T> Specification

## Purpose  
Generic, in-memory + file-backed storage.

## Internals  
- We can use `ConcurrentHashMap<String, T>` or synchronized Map.  
- File-based serialization using Java built-in serialization.  
- File path convention:
  ```
  data/<entity-name>.dat
  ```
  e.g. `data/doctors.dat`

## Required Methods  
```java
void save(T entity);
T find(String id);
List<T> findAll();
void delete(String id);
void serialize();
void deserialize();
```

---

# 8. CSV

## 8.1 Doctor CSV
```
id,name,age,gender,specialization
```

## 8.2 Patient CSV

```
id,name,age,gender,medicalHistory ; // semicolon-separated list
```

## 8.3 Appointment CSV

```
id,doctorId,patientId,appointmentTime,status
```

### Date format for all CSVs

```
yyyy-MM-dd HH:mm
```

---

### 8.4 Date & Time Format

Use:

```
ISO_LOCAL_DATE_TIME (yyyy-MM-dd'T'HH:mm)
```

Internally.
CSV uses a simpler human-readable variant (`yyyy-MM-dd HH:mm`).

---

# 9. Error Handling

## AppointmentNotFoundException  
Thrown when:
- appointment not found  
- deleting/cancelling nonexistent appointment  

## InvalidDataException  
Thrown on:
- malformed entity  
- invalid CSV input  
- invalid appointment request  

## ValidationFailedException
Throw on:
- invalid user input

---

# 10. CLI Menu
The CLI must support:
    - Admin
        - Add doctor  
        - Add patient  
        - Export to CSV
        - Import from CSV  
        - Print summary of all entities
    - Patient
        - Generate bill
        - Cancel appointment
        - Schedule appointment

---

# 11. Deliverables Checklist
- Source code under `src/main/java`  
- `TestRunner.java`  
- `README.md`  
- `docs/Design_Decisions.md`  
- `docs/JVM_Report.md`  
- `docs/Setup_Instructions.md`  
- Optional UML diagram  
- Optional video demo  